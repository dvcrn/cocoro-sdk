/**
 * Representation of the state object that sharp uses to update the entire state
	 all at once
 * { list_item_description }
 * It consists of a 160 character strong that encodes a bunch of different
	 things aka:
 * 6000002000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * It's currently not fully clear what each value does.
 *
 * But to give an example, the temperature is controlled like this:
 *
 * 20.0 -> 4800002000000000000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * 20.5 -> 4900002000000000000000000000000000000000000000000000290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * 21.0 -> 4a000020000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * 21.5 -> 4b000020000000000000000000000000000000000000000000002b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * 22.0 -> 4c000020000000000000000000000000000000000000000000002c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 * 32.0 -> 6000002000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
 *
 @class      State (name)
*/
export class State8 {
	state: string;

	constructor(
		state = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
	) {
		this.state = state;
	}

	get temperature(): number {
		// state uses position 52, 53 to encode temperature
		const t = `${this.state[52]}${this.state[53]}`;
		return parseInt(t, 16) / 2;
	}

	set temperature(t: number) {
		// on setting temp, encode temp as hex into position 52,53
		const s = this.state.split('');
		const hextemp = (t * 2).toString(16);
		s[52] = hextemp[0];
		s[53] = hextemp[1];

		// set position 6 to hex 2
		s[6] = '2';

		// set 0,1 to temperature + 16, don't fully understand why it's 16 higher though
		const hextemp2 = ((t + 16) * 2).toString(16);
		s[0] = hextemp2[0];
		s[1] = hextemp2[1];

		this.state = s.join('');
	}
}
